C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE ML7345_HAL
OBJECT MODULE PLACED IN .\Objects\ML7345_HAL.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE user\src\ML7345_HAL.c OPTIMIZE(0,SPEED) BROWSE INCDIR(.\include;.\user\i
                    -nc) DEBUG OBJECTEXTEND PRINT(.\Listings\ML7345_HAL.lst) OBJECT(.\Objects\ML7345_HAL.obj)

line level    source

   1          #include "ML7345_HAL.h"
   2          
   3          
   4          /*
   5          Function: RF auto status transition control
   6          Parameter: AUTO_TX_EN,AUTO_TXDONE_GORX,AUTO_TXDONE_CONTINUE_RX
   7          Return: Null
   8          */
   9          
  10          void ML7345_AutoStateTransition_Set(u8 sta)
  11          {
  12   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
  13   1          if(sta == AUTO_TX_EN || sta == AUTO_TXDONE_GORX || sta == AUTO_TXDONE_CONTINUE_RX)
  14   1              ML7345_Write_Reg(ADDR_RF_STATUS_CTRL,sta);
  15   1      }
  16          
  17          
  18          /*
  19          Function: RF state setting and status indication
  20          Parameter: TX_ON,RX_ON,TRX_OFF, Force_TRX_OFF
  21          Return: RF status
  22          
  23          Description: RF_STATUS Register é«˜4ä½æŒ‡ç¤ºRFçŠ¶æ€ï¼Œä½Žå››ä½è®¾ç½®RFçŠ¶æ€
  24          *1 During TX operation, setting RX_ON is possible.
  25          In this case, after TX completion, move to RX_ON state automatically.
  26          *2 During RX operation, setting TX_ON is possible.
  27          In this case, after RX completion, move to TX_ON state automatically.
  28          *3 If TRX_OFF is selected during TX or RX operation, after TX or RX operation completed, RF is turned off.
  29          If Force_TRX_OFF is selected during TX or RX operation, RF is turned off immediately
  30          */
  31          u8 ML7345_SetAndGet_State(RF_StatusSet_ENUM sta)
  32          {
  33   1          xdata u8 status = 0;
  34   1      
  35   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
  36   1          status = ML7345_Read_Reg(ADDR_RF_STATUS) >> 4;
  37   1          if(status != sta)
  38   1          {
  39   2              if(sta == TX_ON || sta == RX_ON || sta == TRX_OFF || sta == Force_TRX_OFF)
  40   2              {
  41   3                  ML7345_Write_Reg(ADDR_RF_STATUS,sta);
  42   3                  status = WaitStatus_Complete();
  43   3                  if(status != 0 && sta != Force_TRX_OFF)
  44   3                  {
  45   4                      ML7345_Frequency_Calcul(PROFILE_CH_FREQ_32bit_200002EC,Freq_SetBuff);
  46   4                      ClearWDT();
  47   4                      if(PROFILE_CH_FREQ_32bit_200002EC < 429000000)  RF_ML7345_Init(Freq_SetBuff,0x55,12);
  48   4                      else    RF_ML7345_Init(Freq_SetBuff,0x55,28);
  49   4                      ClearWDT();
  50   4                      ML7345_Write_Reg(ADDR_RF_STATUS,sta);
  51   4                      WaitStatus_Complete();
  52   4                  }
  53   3                  status = ML7345_Read_Reg(ADDR_RF_STATUS) >> 4;
  54   3              }
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 2   

  55   2          }
  56   1          return status;
  57   1      }
  58          
  59          /* ç­‰å¾…RFçŠ¶æ€è½¬æ¢å®Œæˆ */
  60          u8 WaitStatus_Complete(void)
  61          {
  62   1          xdata u16 count = 0;
  63   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
  64   1          while(1)
  65   1          {
  66   2              if(ML7345_Read_Reg(ADDR_INT_SOURCE_GRP1) & 0x08)
  67   2              {
  68   3                  ML7345_Write_Reg(ADDR_INT_SOURCE_GRP1,0x00); //clear
  69   3                  return 0;
  70   3              }
  71   2              if(count++ > 5000)    return 1;
  72   2              ClearWDT();
  73   2          }
  74   1      }
  75          
  76          /*
  77          Function:State clear control
  78          Parameter: TX_FIFO_POINTER,RX_FIFO_POINTER,PHY_STATE
  79          Return: Null
  80          */
  81          void ML7345_StateFlag_Clear(u8 sta)
  82          {
  83   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
  84   1          if(sta == TX_DONE_FLAG)
  85   1          {
  86   2              ML7345_Write_Reg(ADDR_INT_SOURCE_GRP3,0x00);
  87   2              ML7345_Write_Reg(ADDR_STATE_CLR,TX_FIFO_POINTER);
  88   2          }
  89   1          else if(sta == RX_DONE_FLAG)
  90   1          {
  91   2              ML7345_Write_Reg(ADDR_INT_SOURCE_GRP2,0x00);
  92   2              ML7345_Write_Reg(ADDR_STATE_CLR,RX_FIFO_POINTER);
  93   2          }
  94   1      }
  95          /*
  96          Function:Interrupt Status Clear for INT0 to INT23
  97          Parameter: Null
  98          Return: Null
  99          */
 100          
 101          void ML7345_AllStateFlag_Clear(void)
 102          {
 103   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
 104   1          ML7345_Write_Reg(ADDR_INT_SOURCE_GRP1,0x00);
 105   1          ML7345_Write_Reg(ADDR_INT_SOURCE_GRP2,0x00);
 106   1          ML7345_Write_Reg(ADDR_INT_SOURCE_GRP3,0x00);
 107   1      }
 108          
 109          
 110          /*
 111          Function:Data rate set
 112          Parameter: DATA_RATE_1_2K,DATA_RATE_2_4K,DATA_RATE_4_8K,DATA_RATE_9_6K
 113          Return: Null
 114          */
 115          void ML7345_DataRate_Set_4_8k(void)//(DataRate_ENUM rate)
 116          {
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 3   

 117   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 118   1          ML7345_Write_Reg(0x06,0x22);
 119   1          ML7345_Write_Reg(0x07,0x15);
 120   1          ML7345_Write_Reg(0x66,0x1E);
 121   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK1_SEL);
 122   1          ML7345_Write_Reg(0x0C,0x93);
 123   1          ML7345_Write_Reg(0x0D,0x35);
 124   1          ML7345_Write_Reg(0x11,0x27);
 125   1          ML7345_Write_Reg(0x13,0x0C);
 126   1          ML7345_Write_Reg(0x2F,0x08);
 127   1          ML7345_Write_Reg(0x56,0x50);
 128   1          ML7345_Write_Reg(0x57,0x40);
 129   1          ML7345_Write_Reg(0x58,0x01);
 130   1          ML7345_Write_Reg(0x59,0x14);
 131   1          ML7345_Write_Reg(0x5A,0x00);
 132   1          ML7345_Write_Reg(0x5B,0x00);
 133   1          ML7345_Write_Reg(0x5C,0x15);
 134   1          ML7345_Write_Reg(0x5D,0x0D);
 135   1          ML7345_Write_Reg(0x5E,0x05);
 136   1          ML7345_Write_Reg(0x5F,0x67);
 137   1          ML7345_Write_Reg(0x60,0x09);
 138   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK3_SEL);
 139   1          ML7345_Write_Reg(0x0C,0x41);
 140   1          ML7345_Write_Reg(0x0D,0x33);
 141   1          ML7345_Write_Reg(0x0E,0x54);
 142   1          ML7345_Write_Reg(0x14,0x10);
 143   1          ML7345_Write_Reg(0x24,0x03);
 144   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 145   1      }
 146          
 147          void ML7345_DataRate_Set_1_2k(void)
 148          {
 149   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 150   1          ML7345_Write_Reg(0x06,0x00);
 151   1          ML7345_Write_Reg(0x66,0x1E);
 152   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK1_SEL);
 153   1          ML7345_Write_Reg(0x0C,0x93);
 154   1          ML7345_Write_Reg(0x0D,0x35);
 155   1          ML7345_Write_Reg(0x11,0x27);
 156   1          ML7345_Write_Reg(0x13,0x0C);
 157   1          ML7345_Write_Reg(0x2F,0x08);
 158   1          ML7345_Write_Reg(0x57,0x40);
 159   1          ML7345_Write_Reg(0x58,0x01);
 160   1          ML7345_Write_Reg(0x59,0x14);
 161   1          ML7345_Write_Reg(0x5A,0x00);
 162   1          ML7345_Write_Reg(0x5B,0x00);
 163   1          ML7345_Write_Reg(0x5C,0x15);
 164   1          ML7345_Write_Reg(0x5D,0x1B);
 165   1          ML7345_Write_Reg(0x5E,0x05);
 166   1          ML7345_Write_Reg(0x5F,0x67);
 167   1          ML7345_Write_Reg(0x60,0x0C);
 168   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK3_SEL);
 169   1          ML7345_Write_Reg(0x0C,0x41);
 170   1          ML7345_Write_Reg(0x0D,0x33);
 171   1          ML7345_Write_Reg(0x0E,0x54);
 172   1          ML7345_Write_Reg(0x14,0x10);
 173   1          ML7345_Write_Reg(0x24,0x03);
 174   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 175   1      }
 176          /*
 177          void ML7345_DataRate_Set_2_4k(void)//(DataRate_ENUM rate)
 178          {
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 4   

 179              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 180              ML7345_Write_Reg(0x06,0x11);
 181              ML7345_Write_Reg(0x07,0x15);
 182              ML7345_Write_Reg(0x66,0x1E);
 183              ML7345_Write_Reg(ADDR_BANK_SEL,BANK1_SEL);
 184              ML7345_Write_Reg(0x0C,0x93);
 185              ML7345_Write_Reg(0x0D,0x35);
 186              ML7345_Write_Reg(0x11,0x27);
 187              ML7345_Write_Reg(0x13,0x0C);
 188              ML7345_Write_Reg(0x2F,0x08);
 189              ML7345_Write_Reg(0x56,0x50);
 190              ML7345_Write_Reg(0x57,0x40);
 191              ML7345_Write_Reg(0x58,0x01);
 192              ML7345_Write_Reg(0x59,0x14);
 193              ML7345_Write_Reg(0x5A,0x00);
 194              ML7345_Write_Reg(0x5B,0x00);
 195              ML7345_Write_Reg(0x5C,0x15);
 196              ML7345_Write_Reg(0x5D,0x0D);
 197              ML7345_Write_Reg(0x5E,0x05);
 198              ML7345_Write_Reg(0x5F,0x67);
 199              ML7345_Write_Reg(0x60,0x09);
 200              ML7345_Write_Reg(ADDR_BANK_SEL,BANK3_SEL);
 201              ML7345_Write_Reg(0x0C,0x41);
 202              ML7345_Write_Reg(0x0D,0x33);
 203              ML7345_Write_Reg(0x0E,0x54);
 204              ML7345_Write_Reg(0x14,0x10);
 205              ML7345_Write_Reg(0x24,0x03);
 206              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 207          }
 208          
 209          void ML7345_DataRate_Set_9_6k(void)//(DataRate_ENUM rate)
 210          {
 211              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 212              ML7345_Write_Reg(0x06,0x33);
 213              ML7345_Write_Reg(0x07,0x15);
 214              ML7345_Write_Reg(0x66,0x1E);
 215              ML7345_Write_Reg(ADDR_BANK_SEL,BANK1_SEL);
 216              ML7345_Write_Reg(0x0C,0x93);
 217              ML7345_Write_Reg(0x0D,0x35);
 218              ML7345_Write_Reg(0x11,0x27);
 219              ML7345_Write_Reg(0x13,0x0C);
 220              ML7345_Write_Reg(0x2F,0x08);
 221              ML7345_Write_Reg(0x56,0x50);
 222              ML7345_Write_Reg(0x57,0x04);
 223              ML7345_Write_Reg(0x58,0x01);
 224              ML7345_Write_Reg(0x59,0x14);
 225              ML7345_Write_Reg(0x5A,0x00);
 226              ML7345_Write_Reg(0x5B,0x00);
 227              ML7345_Write_Reg(0x5C,0x15);
 228              ML7345_Write_Reg(0x5D,0x0D);
 229              ML7345_Write_Reg(0x5E,0x04);
 230              ML7345_Write_Reg(0x5F,0x5D);
 231              ML7345_Write_Reg(0x60,0x0C);
 232              ML7345_Write_Reg(ADDR_BANK_SEL,BANK3_SEL);
 233              ML7345_Write_Reg(0x0C,0x41);
 234              ML7345_Write_Reg(0x0D,0x33);
 235              ML7345_Write_Reg(0x0E,0x54);
 236              ML7345_Write_Reg(0x14,0x10);
 237              ML7345_Write_Reg(0x24,0x03);
 238              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 239          }
 240          */
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 5   

 241          
 242          /*
 243          Function: FIFO readout setting
 244          Parameter: 0:RX FIFO read when reading FIFO(ADDR_RD_FIFO); 1: TX FIFO read when reading FIFO(ADDR_RD_FIFO)
 245          Return: Null
 246          *//*
 247          void ML7345_FIFO_ReadOut_Set(u8 select)
 248          {
 249              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 250              if(select == 0x00)  ML7345_Write_Reg(ADDR_FIFO_SET,0x00);
 251              else if(select == 0x01) ML7345_Write_Reg(ADDR_FIFO_SET,0x01);
 252          }
 253          */
 254          
 255          /*
 256          Function: Get ED value
 257          Parameter: Null
 258          Return: ED value
 259          *//*
 260          u8 ML7345_RSSI_Val(void)
 261          {
 262              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 263              return ML7345_Read_Reg(ADDR_ED_RSLT);
 264          }
 265          */
 266          
 267          /*
 268          Function: Soft Reset
 269          Parameter: Null
 270          Return: Null
 271          *//*
 272          void ML7345_SoftReset(void)
 273          {
 274              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 275              ML7345_Write_Reg(ADDR_RST_SET,0xff);
 276          }*/
 277          
 278          /*
 279          Function: Hardware Reset
 280          Parameter: Null
 281          Return: Null
 282          */
 283          void ML7345_RESETN_SET(void)
 284          {
 285   1          ML7345_RESETN = 0;
 286   1          delay_ms(2);
 287   1          ML7345_RESETN = 1;
 288   1      }
 289          
 290          /*
 291          Function: Sleep Mode Set
 292          Parameter: Deep_Sleep,Sleep1_Mode,Sleep2_Mode
 293          Return: Null
 294          *//*
 295          void ML7345_GoSleep(SleepMode_ENUM mode)
 296          {
 297              switch(mode)
 298              {
 299                  case Deep_Sleep:
 300                      //RF_WORKE_MODE = 1;
 301                      break;
 302          
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 6   

 303                  case Sleep1_Mode:
 304                      ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL); // Bank0 Set
 305                      ML7345_Write_Reg(ADDR_CLK_SET2,ML7345_Read_Reg(ADDR_CLK_SET2) & 0xF7);
 306                      ML7345_Write_Reg(ADDR_SLEEP_WU_SET,0x07);
 307                      break;
 308          
 309                  case Sleep2_Mode:
 310                      ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL); // Bank0 Set
 311                      ML7345_Write_Reg(ADDR_CLK_SET2,ML7345_Read_Reg(ADDR_CLK_SET2) | 0x08);
 312                      ML7345_Write_Reg(ADDR_SLEEP_WU_SET,0x37);
 313                      break;
 314          
 315                  default:
 316                      break;
 317              }
 318          }*/
 319          
 320          
 321          /*
 322          Function: Frequency Set
 323          Parameter: Frequency
 324          Return: Null
 325          */
 326          void ML7345_Frequency_Set(u8 *freq,u8 radio_type)
 327          {
 328   1          Flag_set_freq = 1;
 329   1          if(ML7345_SetAndGet_State(Get_Sta) != TRX_OFF)
 330   1              ML7345_SetAndGet_State(Force_TRX_OFF);
 331   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK1_SEL); /* Bank1 Set */
 332   1          ML7345_Write_Reg(ADDR_TXFREQ_I,freq[0]);
 333   1          ML7345_Write_Reg(ADDR_TXFREQ_FH,freq[1]);
 334   1          ML7345_Write_Reg(ADDR_TXFREQ_FM,freq[2]);
 335   1          ML7345_Write_Reg(ADDR_TXFREQ_FL,freq[3]);
 336   1          ML7345_Write_Reg(ADDR_RXFREQ_I,freq[0]);
 337   1          ML7345_Write_Reg(ADDR_RXFREQ_FH,freq[1]);
 338   1          ML7345_Write_Reg(ADDR_RXFREQ_FM,freq[2]);
 339   1          ML7345_Write_Reg(ADDR_RXFREQ_FL,freq[3]);
 340   1      
 341   1          ML7345_Write_Reg(ADDR_VCO_CAL_MIN_I,freq[4]);      //P107
 342   1          ML7345_Write_Reg(ADDR_VCO_CAL_MIN_FH,freq[5]);
 343   1          ML7345_Write_Reg(ADDR_VCO_CAL_MIN_FM,freq[6]);
 344   1          ML7345_Write_Reg(ADDR_VCO_CAL_MIN_FL,freq[7]);
 345   1      
 346   1          ML7345_Write_Reg(0x00,0x22);    /* Bank1 Set */
 347   1          ML7345_Write_Reg(0x25,0x08);    /* SyncWord length setting */
 348   1          ML7345_Write_Reg(0x2a,0x55);
 349   1      
 350   1          if(radio_type == 1) ML7345_DataRate_Set_1_2k();
 351   1          else if(radio_type == 2)  ML7345_DataRate_Set_4_8k();
 352   1      
 353   1          ML7345_Write_Reg(0x6f, 0x01);     /* VCO_CAL_START(CAL start) */
 354   1          while(1){
 355   2              if(ML7345_Read_Reg(0x0Du)&0x02u){   /* Wait VCO calibration completion */
 356   3                  break;
 357   3              }
 358   2          }
 359   1      
 360   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL); /* Bank0 Set */
 361   1          Flag_set_freq = 0;
 362   1      }
 363          
 364          
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 7   

 365          /*
 366          Function: ML7345 TX RX INT CONFIG
 367          Parameter: GpioCtrlAddr:GPIO ADDR; Intnum:Tx Done Interrupt or Rx Done Interrupt; Inten:1 Enable,0 Disable
 368          Return: Null
 369          */
 370          void ML7345_TRX_Int_Config(u8 GpioCtrlAddr,RF_TRX_ENUM Intnum,u8 Inten)
 371          {
 372   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);    /* BANK 0 SEL*/
 373   1          if(Inten)
 374   1          {
 375   2              ML7345_Write_Reg(GpioCtrlAddr,GPIO_INTOUTPUT_ENABLE);    /* GPIO ä¸­æ–­è¾“å‡º(SINTN) */
 376   2      
 377   2              if(Intnum == RF_TxDone_Int)  ML7345_Write_Reg(ADDR_INT_EN_GRP3,0x01);    /* ä½¿èƒ½ä¸­æ–­äº‹ä»¶16,å
             -‘é€å®Œæˆä¸­æ–­ */
 378   2              else if(Intnum == RF_RxDone_Int) ML7345_Write_Reg(ADDR_INT_EN_GRP2,0x21);/* 0x21:ä½¿èƒ½ä¸­æ–­äº‹ä»
             -¶8/13,æŽ¥æ”¶å®Œæˆä¸­æ–­/åŒæ­¥å­—æ£€æµ‹ä¸­æ–­;0x01:ä½¿èƒ½ä¸­æ–­äº‹ä»¶8,æŽ¥æ”¶å®Œæˆä¸­æ–­ */
 379   2              //else if(Intnum == RF_RxDone_Int) ML7345_Write_Reg(ADDR_INT_EN_GRP2,0x01); //0x01:ä½¿èƒ½ä¸­æ–­äº‹
             -ä»¶8,æŽ¥æ”¶å®Œæˆä¸­æ–­
 380   2          }
 381   1          else
 382   1          {
 383   2              ML7345_Write_Reg(GpioCtrlAddr,GPIO_INTOUTPUT_DISABLE);    /* GPIO ç¦æ­¢ä¸­æ–­è¾“å‡º(SINTN) */
 384   2      
 385   2              if(Intnum == RF_TxDone_Int)  ML7345_Write_Reg(ADDR_INT_EN_GRP3,0x00);    /* ç¦æ­¢ä¸­æ–­äº‹ä»¶16,å
             -‘é€å®Œæˆä¸­æ–­ */
 386   2              else if(Intnum == RF_RxDone_Int) ML7345_Write_Reg(ADDR_INT_EN_GRP2,0x00);/* ç¦æ­¢ä¸­æ–­äº‹ä»¶8,æŽ
             -¥æ”¶å®Œæˆä¸­æ–­ */
 387   2          }
 388   1      }
 389          
 390          void ML7345_GPIO0TxDoneInt_Enable(void)
 391          {
 392   1          ML7345_TRX_Int_Config(ADDR_GPIO0_CTRL,RF_TxDone_Int,1);
 393   1      }
 394          void ML7345_GPIO0RxDoneInt_Enable(void)
 395          {
 396   1          ML7345_TRX_Int_Config(ADDR_GPIO0_CTRL,RF_RxDone_Int,1);
 397   1      }
 398          /*
 399          void ML7345_GPIO1TxDoneInt_Enable(void)
 400          {
 401              ML7345_TRX_Int_Config(ADDR_GPIO1_CTRL,RF_TxDone_Int,1);
 402          }
 403          void ML7345_GPIO1TxDoneInt_Disable(void)
 404          {
 405              ML7345_TRX_Int_Config(ADDR_GPIO1_CTRL,RF_TxDone_Int,0);
 406          }
 407          
 408          void ML7345_GPIO1RxDoneInt_Enable(void)
 409          {
 410              ML7345_TRX_Int_Config(ADDR_GPIO1_CTRL,RF_RxDone_Int,1);
 411          }
 412          void ML7345_GPIO1RxDoneInt_Disable(void)
 413          {
 414              ML7345_TRX_Int_Config(ADDR_GPIO1_CTRL,RF_RxDone_Int,0);
 415          }
 416          
 417          void ML7345_GPIO2TxDoneInt_Enable(void)
 418          {
 419              ML7345_TRX_Int_Config(ADDR_GPIO2_CTRL,RF_TxDone_Int,1);
 420          }
 421          void ML7345_GPIO2TxDoneInt_Disable(void)
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 8   

 422          {
 423              ML7345_TRX_Int_Config(ADDR_GPIO2_CTRL,RF_TxDone_Int,0);
 424          }
 425          
 426          void ML7345_GPIO2RxDoneInt_Enable(void)
 427          {
 428              ML7345_TRX_Int_Config(ADDR_GPIO2_CTRL,RF_RxDone_Int,1);
 429          }
 430          void ML7345_GPIO2RxDoneInt_Disable(void)
 431          {
 432              ML7345_TRX_Int_Config(ADDR_GPIO2_CTRL,RF_RxDone_Int,0);
 433          }
 434          */
 435          
 436          /*
 437          Function: Transmit Power Setting
 438          Parameter: Frequency
 439          Return: Null
 440          *//*
 441          void ML7345_TransmitPower_Set(TransmitPower_ENUM Power)
 442          {
 443              if(ML7345_SetAndGet_State(Get_Sta) != TRX_OFF)
 444                  ML7345_SetAndGet_State(TRX_OFF);
 445              ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL); // Bank0 Set 
 446              switch(Power)
 447              {
 448                  case Power_0dBm:
 449                      ML7345_Write_Reg(ADDR_PA_MODE,0x02);
 450                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 451                      ML7345_Write_Reg(ADDR_PA_ADJ,0x00);
 452                      break;
 453                  case Power_1dBm:
 454                      ML7345_Write_Reg(ADDR_PA_MODE,0x03);
 455                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 456                      ML7345_Write_Reg(ADDR_PA_ADJ,0x01);
 457                      break;
 458                  case Power_1_5dBm:
 459                      ML7345_Write_Reg(ADDR_PA_MODE,0x06);
 460                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 461                      ML7345_Write_Reg(ADDR_PA_ADJ,0x01);
 462                      break;
 463                  case Power_2dBm:
 464                      ML7345_Write_Reg(ADDR_PA_MODE,0x07);
 465                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 466                      ML7345_Write_Reg(ADDR_PA_ADJ,0x01);
 467                      break;
 468                  case Power_3dBm:
 469                      ML7345_Write_Reg(ADDR_PA_MODE,0x06);
 470                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 471                      ML7345_Write_Reg(ADDR_PA_ADJ,0x03);
 472                      break;
 473                  case Power_4dBm:
 474                      ML7345_Write_Reg(ADDR_PA_MODE,0x07);
 475                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 476                      ML7345_Write_Reg(ADDR_PA_ADJ,0x04);
 477                      break;
 478                  case Power_5dBm:
 479                      ML7345_Write_Reg(ADDR_PA_MODE,0x07);
 480                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 481                      ML7345_Write_Reg(ADDR_PA_ADJ,0x06);
 482                      break;
 483                  case Power_6dBm:
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 9   

 484                      ML7345_Write_Reg(ADDR_PA_MODE,0x06);
 485                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 486                      ML7345_Write_Reg(ADDR_PA_ADJ,0x09);
 487                      break;
 488                  case Power_7dBm:
 489                      ML7345_Write_Reg(ADDR_PA_MODE,0x07);
 490                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 491                      ML7345_Write_Reg(ADDR_PA_ADJ,0x0B);
 492                      break;
 493                  case Power_8dBm:
 494                      ML7345_Write_Reg(ADDR_PA_MODE,0x13);
 495                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 496                      ML7345_Write_Reg(ADDR_PA_ADJ,0x00);
 497                      break;
 498                  case Power_9dBm:
 499                      ML7345_Write_Reg(ADDR_PA_MODE,0x16);
 500                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 501                      ML7345_Write_Reg(ADDR_PA_ADJ,0x00);
 502                      break;
 503                  case Power_10dBm:
 504                      ML7345_Write_Reg(ADDR_PA_MODE,0x15);
 505                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 506                      ML7345_Write_Reg(ADDR_PA_ADJ,0x01);
 507                      break;
 508                  case Power_11dBm:
 509                      ML7345_Write_Reg(ADDR_PA_MODE,0x16);
 510                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 511                      ML7345_Write_Reg(ADDR_PA_ADJ,0x02);
 512                      break;
 513                  case Power_12dBm:
 514                      ML7345_Write_Reg(ADDR_PA_MODE,0x16);
 515                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 516                      ML7345_Write_Reg(ADDR_PA_ADJ,0x03);
 517                      break;
 518                  case Power_13dBm:
 519                      ML7345_Write_Reg(ADDR_PA_MODE,0x15);
 520                      ML7345_Write_Reg(ADDR_PA_REG_FINE_ADJ,0x10);
 521                      ML7345_Write_Reg(ADDR_PA_ADJ,0x05);
 522                      break;
 523                  default:
 524                      break;
 525              }
 526          }*/
 527          
 528          /*
 529          Function: Read receive packet
 530          Parameter: pbuf: RX buffer; len: Read length,No more than 64 bytes
 531          Return: Null
 532          */
 533          void ML7345_ReadRx_Pack(u8 *pbuf,u8 len)
 534          {
 535   1          if(len > 64)    len = 64;
 536   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);
 537   1          ML7345_Read_Fifo(ADDR_RD_FIFO,pbuf,len);
 538   1      }
 539          
 540          /*
 541          Function: send data
 542          Parameter: pbuf: data buffer; len: data length,No more than 64 bytes
 543          Return: Null
 544          */
 545          void ML7345_AutoTx_Data(u8 *pbuf,u8 len)
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 10  

 546          {
 547   1          if(len > 64)    len = 64;
 548   1          CG2214M6_USE_T;
 549   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
 550   1          ML7345_Write_Reg(ADDR_TX_PKT_LEN_L,len);    //å‘é€åŒ…é•¿åº¦ä½Žå…«ä½
 551   1          ML7345_AutoStateTransition_Set(AUTO_TX_EN);  //è®¾ç½®ä¸ºè‡ªåŠ¨å‘é€æ¨¡å¼
 552   1          ML7345_Write_Fifo(ADDR_WR_TX_FIFO,pbuf,len);
 553   1      }
 554          
 555          u8 RF_SyncWord_DONE(void)
 556          {
 557   1          idata u8 sync = 0;
 558   1          ML7345_Write_Reg(ADDR_BANK_SEL,BANK0_SEL);  //set bank0
 559   1          sync = ML7345_Read_Reg(ADDR_INT_SOURCE_GRP2);
 560   1          return sync;
 561   1      }
 562          
 563          void ML7345_Frequency_Calcul(u32 Freq,u8 *pbuf)  //å°†é¢‘çŽ‡è®¡ç®—ä¸ºML7345å¯„å­˜å™¨è®¾å®šå€¼,å­˜å…¥pbufä¸
             -­
 564          {
 565   1          xdata u8 integer = 0;
 566   1          xdata float f_dec = 0.0;
 567   1          xdata u32 cal_val = 0;
 568   1          integer = (u8)(Freq / FREQ_PLL);
 569   1          f_dec = ((float)(Freq / (float)FREQ_PLL) - integer);
 570   1          cal_val = (u32)(f_dec *  CONST_COEFF);
 571   1          pbuf[0] = integer;
 572   1          pbuf[1] = (cal_val >> 16) & 0xff;
 573   1          pbuf[2] = (cal_val >> 8) & 0xff;
 574   1          pbuf[3] = cal_val & 0xff;
 575   1      
 576   1          Freq = Freq - VCO_LowerLimit_FREQ;
 577   1          integer = (u8)(Freq / FREQ_PLL);
 578   1          f_dec = ((float)(Freq / (float)FREQ_PLL) - integer);
 579   1          cal_val = (u32)(f_dec *  CONST_COEFF);
 580   1          pbuf[4] = integer;
 581   1          pbuf[5] = (cal_val >> 16) & 0xff;
 582   1          pbuf[6] = (cal_val >> 8) & 0xff;
 583   1          pbuf[7] = cal_val & 0xff;
 584   1      }
 585          
 586          void SetReg_Rssi(void)
 587          {
 588   1          ML7345_Write_Reg(0x00,0x22);  //Bank 1
 589   1          ML7345_Write_Reg(0x07,0x5A);
 590   1          ML7345_Write_Reg(0x0C,0x8A);
 591   1          ML7345_Write_Reg(0x0D,0x26);
 592   1          ML7345_Write_Reg(0x10,0x03);
 593   1          ML7345_Write_Reg(0x15,0x83);
 594   1          ML7345_Write_Reg(0x00,0x11);  //Bank 0
 595   1      }
 596          
 597          /*
 598          void SetReg_RssiTest(void)
 599          {
 600              ML7345_Write_Reg(0x00,0x22);  //Bank 1
 601              ML7345_Write_Reg(0x07,0x5A);
 602              ML7345_Write_Reg(0x10,0x03);
 603              ML7345_Write_Reg(0x12,0x77);
 604              ML7345_Write_Reg(0x15,0x83);
 605          
 606              ML7345_Write_Reg(0x00,0x44);  //Bank 2
C51 COMPILER V9.60.0.0   ML7345_HAL                                                        02/25/2022 17:15:45 PAGE 11  

 607              ML7345_Write_Reg(0x09,0x09);
 608              ML7345_Write_Reg(0x0C,0x7D);
 609              ML7345_Write_Reg(0x0E,0x00);
 610              ML7345_Write_Reg(0x16,0x23);
 611              ML7345_Write_Reg(0x1C,0x23);
 612              ML7345_Write_Reg(0x2A,0x0F);
 613              ML7345_Write_Reg(0x4E,0x70);
 614          
 615              ML7345_Write_Reg(0x00,0x88);  //Bank 3
 616              ML7345_Write_Reg(0x31,0x00);
 617              ML7345_Write_Reg(0x32,0x00);
 618              ML7345_Write_Reg(0x33,0x00);
 619              ML7345_Write_Reg(0x34,0x00);
 620              ML7345_Write_Reg(0x35,0x00);
 621              ML7345_Write_Reg(0x36,0x00);
 622              ML7345_Write_Reg(0x37,0x00);
 623              ML7345_Write_Reg(0x38,0x00);
 624          
 625              ML7345_Write_Reg(0x00,0x11);  //Bank 0
 626          }*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2151    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     12    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25    ----
   IDATA SIZE       =      1    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
