C51 COMPILER V9.60.0.0   GPIO                                                              04/15/2022 17:34:28 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE GPIO
OBJECT MODULE PLACED IN .\Objects\gpio.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE user\src\gpio.c OPTIMIZE(0,SPEED) BROWSE INCDIR(.\include;.\user\inc) DE
                    -BUG OBJECTEXTEND PRINT(.\Listings\gpio.lst) OBJECT(.\Objects\gpio.obj)

line level    source

   1          #include "gpio.h"
   2          
   3          
   4          /***********************************************************************************
   5          函数名称:   void InitPort(void)
   6          功能描述:   IO配置
   7          输入参数:   
   8          返回参数:     
   9          *************************************************************************************/
  10          void Init_Port(void)
  11          { 
  12   1          /* CLOSE/STOP/OPEN: P10/P11/P12; TP7: P13 TestMode */
  13   1          PORT_SetP1OpenDrain(BIT0|BIT1|BIT2|BIT3);           // 设置P13 为开漏输出
  14   1          PORT_SetP1PushPull(BIT0|BIT1|BIT2);                 // 设置P10,P11,P12 为推挽输出
  15   1          P13 = 1;                                            // P13设为输入模式
  16   1          PORT_EnP10P11P12P13PullHigh();                      // 使能 P10,P11,P12,P13 上拉
  17   1          
  18   1          /* SPI */
  19   1          PORT_SetP1PushPull(BIT4|BIT5|BIT7);                                 // 设置P15(MOSI),P17(SPICLK)为准双向口
  20   1              PORT_SetP1OpenDrain(BIT6);                                                      // 设置P16(MISO)为准双向口
  21   1          P16 = 1;                                            // 输入
  22   1              PORT_EnP14P15P16P17PullHigh();                                          // 使能 P14,P15,P16,P17 上拉
  23   1          
  24   1          /*BEEP:P20; 登录:P21; 无线开关:T->P22,R->P23; 受信/动作/送信LED:P24/P25/P26; ML7345_RESETN:P27 */
  25   1              PORT_SetP2OpenDrain(BIT1);                          // 设置P21 为开漏输出
  26   1          P21 = 1;                                            // P21设为输入模式
  27   1          
  28   1      #if (NEW_PCB==0)   
                  PORT_SetP2PushPull(BIT0|BIT2|BIT3|BIT4|BIT5|BIT6|BIT7); // 设置P20,P22,P23,P24,P25,P26,P27 为推挽输出
              #else
  31   1          PORT_SetP2PushPull(BIT0|BIT2|BIT3|BIT5|BIT7);       // 设置P20,P22,P23,P25,P27 为推挽输出
  32   1          PORT_SetP2OpenDrain(BIT4);
  33   1          P24 = 1;
  34   1      #endif
  35   1          
  36   1          PORT_EnP20P21P22P23PullHigh();                      // 使能 P20,P21,P22,P23 上拉
  37   1              PORT_EnP24P25P26P27PullHigh();                              // 使能 P24,P25,P26,P27 上拉
  38   1          P20 = 0;
  39   1          
  40   1      #if (NEW_PCB==0)  
                  PORT_SetP3InputOnly(BIT5);
              #else
  43   1          //PORT_SetP3PushPull(BIT4|BIT5);
  44   1          PORT_SetP3QuasiBi(0xFF);                            //设置P3位准双向口模式
  45   1      #endif
  46   1       
  47   1          /* TP3/TP4: P40/P41 */
  48   1          PORT_SetP4OpenDrain(BIT0|BIT1);                     // 设置P40,P41 为开漏输出
  49   1          P40 = 1; P41 = 1;                                   // P40/p41 设为输入模式
  50   1          PORT_EnP40P41PullHigh();                            // 使能 P40,P41 上拉
  51   1          
  52   1          //////////////////////test/////////////////////////
  53   1          //PORT_SetP6PushPull(BIT0);   //CLK OUT
  54   1          //AUXR0 &= ~(P60OC0|P60OC1);
C51 COMPILER V9.60.0.0   GPIO                                                              04/15/2022 17:34:28 PAGE 2   

  55   1          //AUXR0 |= (0x80|P60FD);
  56   1          //////////////////////test/////////////////////////
  57   1          
  58   1          FG_allow_out = 1;
  59   1              FG_NOT_allow_out = 0;
  60   1          Receiver_LED_TX = 0;  
  61   1          Receiver_LED_RX = 0;  
  62   1          Receiver_LED_OUT = 0; 
  63   1          Receiver_OUT_OPEN = 0;
  64   1          Receiver_OUT_STOP = 0;
  65   1          Receiver_OUT_CLOSE = 0;
  66   1          ML7345_RESETN = 0;
  67   1      }
  68          
  69           
  70          
  71          
  72          
  73          /***********************************************************************************
  74          函数名称:   void InitINT0(void)
  75          功能描述:   INT0初始化
  76          输入参数:   
  77          返回参数:  
  78          用于ML7345D 发送接收完成中断。
  79          *************************************************************************************/
  80          void Init_INT0(void)
  81          {
  82   1              INT_SetINT0P32();                                               //设置INT0引脚P32
  83   1              INT_SetINT0_DetectFallingEdge();                //设置INT0外部中断检测方式为下降沿检测
  84   1              //INT_SetINT0_DetectRisingEdge();
  85   1          INT_SetINT0Filter_Sysclk_x3();                      //设置INT0滤波为（sysclk）*3
  86   1      }
  87          
  88          
  89          /***********************************************************************************
  90          函数名称:   void InitINT1(void)
  91          功能描述:   INT1初始化
  92          输入参数:   
  93          返回参数:   
  94          ML7345D BER测试。
  95          *************************************************************************************/
  96          #if (NEW_PCB==1)
  97          void Init_INT1(void)
  98          {
  99   1              INT_SetINT1P33();                                               //设置INT1引脚P33
 100   1              //INT_SetINT1_DetectRisingEdge();               
 101   1          INT_SetINT1_DetectFallingEdge();        //设置INT1外部中断检测方式为下降沿检测
 102   1              INT_SetINT1Filter_Sysclk_x3();                  //设置INT1滤波为（sysclk）*3
 103   1      }
 104          #endif
 105          
 106          /***********************************************************************************
 107          函数名称:   void INT_INT0(void) 
 108          功能描述:INT0中断服务程序
 109          输入参数:   
 110          返回参数: 
 111          
 112          用于ML7345D发送接收完成中断。
 113          
 114          *************************************************************************************/
 115          void INT_INT0(void)             interrupt INT_VECTOR_INT0
 116          {
C51 COMPILER V9.60.0.0   GPIO                                                              04/15/2022 17:34:28 PAGE 3   

 117   1              if(Flag_test_mode == 0) ML7345_TRX_Del();
 118   1          else DataReceive();
 119   1      }
 120          
 121          
 122          /***********************************************************************************
 123          函数名称:   void INT_INT1(void) 
 124          功能描述:INT1中断服务程序
 125          输入参数:   
 126          返回参数:    
 127          
 128          ML7345D BER测试。
 129          
 130          *************************************************************************************/
 131          void INT_INT1(void)             interrupt INT_VECTOR_INT1
 132          {
 133   1              if(Flag_test_mode == 0) ML7345_TRX_Del();
 134   1          else DataReceive();
 135   1      }
 136          
 137          
 138          /***********************************************************************************
 139          函数名称:   void InitInterrupt(void)
 140          功能描述:   中断初始化
 141          输入参数:    
 142          返回参数:     
 143          *************************************************************************************/
 144          void Init_Interrupt(void)
 145          {
 146   1      #if (NEW_PCB==0)
                  Init_INT0();
                  INT_EnINT0();                       //      使能INT0中断
              #else
 150   1          Init_INT1();
 151   1              INT_EnINT1();                   //      使能INT1中断
 152   1      #endif
 153   1          INT_EnTIMER0();                     //      使能T0中断
 154   1              INT_EnUART0();                  //      使能串口中断
 155   1      }
 156          
 157          
 158          /*
 159          u8 key_scan(void)
 160          {
 161              if((Receiver_Login==0 | TP3==0 | TP4==0 | Receiver_test==0))
 162              {
 163                  delay_ms(50);
 164                  if((Receiver_Login==0 | TP3==0 | TP4==0 | Receiver_test==0) && key_flag == 0)
 165                  {
 166                      key_flag = 1;
 167                      if(Receiver_Login==0) return 2;
 168                      else if (Receiver_test==0) return 3;
 169                      else return 1;
 170                  }
 171                  else return 0;
 172                      
 173              }
 174              else if(Receiver_Login==1 && TP3==1 && TP4==1 && Receiver_test==1)
 175              {
 176                  key_flag = 0;
 177                  return 0;
 178              }
C51 COMPILER V9.60.0.0   GPIO                                                              04/15/2022 17:34:28 PAGE 4   

 179              return 0;    
 180          }*/
 181          
 182          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    292    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
